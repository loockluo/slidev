---
sidebar_position: 3
title: ğŸ’¾ æŒä¹…åŒ–
description: æ·±å…¥ç†è§£ LangGraphJS ä¸­çš„æ£€æŸ¥ç‚¹æœºåˆ¶å’ŒçŠ¶æ€æŒä¹…åŒ–
---

# ğŸ’¾ æŒä¹…åŒ–

åœ¨æ„å»ºå¤æ‚çš„ AI åº”ç”¨æ—¶ï¼ŒæŒä¹…åŒ–æ˜¯ä¸€ä¸ªè‡³å…³é‡è¦çš„åŠŸèƒ½ã€‚å°±åƒå‰ç«¯åº”ç”¨éœ€è¦ä¿å­˜ç”¨æˆ·æ•°æ®å’Œåº”ç”¨çŠ¶æ€ä¸€æ ·ï¼ŒLangGraphJS åº”ç”¨ä¹Ÿéœ€è¦èƒ½å¤Ÿä¿å­˜å’Œæ¢å¤æ‰§è¡ŒçŠ¶æ€ã€‚LangGraphJS é€šè¿‡å¼ºå¤§çš„æ£€æŸ¥ç‚¹æœºåˆ¶æä¾›äº†å®Œæ•´çš„æŒä¹…åŒ–è§£å†³æ–¹æ¡ˆã€‚

## ğŸ¯ æŒä¹…åŒ–æ¦‚è¿°

ä»å‰ç«¯å¼€å‘çš„è§’åº¦æ¥ç†è§£ï¼ŒLangGraphJS çš„æŒä¹…åŒ–æœºåˆ¶ç±»ä¼¼äºï¼š

- **æ£€æŸ¥ç‚¹** ç±»ä¼¼äº Git çš„æäº¤è®°å½• - æ¯ä¸ªæ‰§è¡Œæ­¥éª¤éƒ½ä¼šä¿å­˜çŠ¶æ€å¿«ç…§
- **çº¿ç¨‹** ç±»ä¼¼äºæµè§ˆå™¨çš„ä¼šè¯ - æ¯ä¸ªå¯¹è¯æˆ–æ‰§è¡Œæµç¨‹éƒ½æœ‰å”¯ä¸€æ ‡è¯†
- **çŠ¶æ€æ¢å¤** ç±»ä¼¼äºé¡µé¢åˆ·æ–°åçš„çŠ¶æ€æ¢å¤ - åº”ç”¨å¯ä»¥ä»ä»»æ„ç‚¹ç»§ç»­æ‰§è¡Œ
- **æ—¶é—´æ—…è¡Œ** ç±»ä¼¼äºç‰ˆæœ¬æ§åˆ¶çš„å›æ»š - å¯ä»¥å›åˆ°ä»»æ„å†å²çŠ¶æ€

```mermaid
graph TD
    A[ç”¨æˆ·è¯·æ±‚] --> B{æ˜¯å¦æœ‰æ£€æŸ¥ç‚¹?}
    B -->|å¦| C[åˆ›å»ºæ–°çº¿ç¨‹]
    B -->|æ˜¯| D[åŠ è½½æ£€æŸ¥ç‚¹]

    C --> E[æ‰§è¡ŒèŠ‚ç‚¹]
    D --> E

    E --> F[ä¿å­˜æ£€æŸ¥ç‚¹]
    F --> G{æ˜¯å¦å®Œæˆ?}

    G -->|å¦| H[æ‰§è¡Œä¸‹ä¸€èŠ‚ç‚¹]
    G -->|æ˜¯| I[ç»“æŸ]

    H --> F

    F --> J[(å­˜å‚¨åç«¯)]
    J --> K[å†…å­˜å­˜å‚¨]
    J --> L[SQLite]
    J --> M[PostgreSQL]

    classDef default fill:#f2f0ff;
    classDef storage fill:#e1f5fe;
    classDef process fill:#f3e5f5;

    class J,K,L,M storage;
    class E,F,H process;
```

## ğŸ“ æ£€æŸ¥ç‚¹æœºåˆ¶

æ£€æŸ¥ç‚¹æ˜¯ LangGraphJS æŒä¹…åŒ–çš„æ ¸å¿ƒæ¦‚å¿µï¼Œå®ƒåœ¨æ¯ä¸ªæ­¥éª¤åè‡ªåŠ¨ä¿å­˜å›¾çš„çŠ¶æ€å¿«ç…§ã€‚

### æ ¸å¿ƒæ¦‚å¿µ

#### çº¿ç¨‹ï¼ˆThreadï¼‰

çº¿ç¨‹æ˜¯æ¯ä¸ªæ£€æŸ¥ç‚¹çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œç±»ä¼¼äºæ•°æ®åº“ä¸­çš„ä¸»é”®ã€‚æ¯ä¸ªçº¿ç¨‹ä»£è¡¨ä¸€ä¸ªç‹¬ç«‹çš„æ‰§è¡Œæµç¨‹ï¼Œå¯ä»¥æ˜¯ç”¨æˆ·ä¼šè¯ã€ä»»åŠ¡å®ä¾‹æˆ–ä»»ä½•éœ€è¦ç‹¬ç«‹çŠ¶æ€ç®¡ç†çš„åœºæ™¯ã€‚

```typescript
// çº¿ç¨‹ç®¡ç†ï¼šä¸ºæ¯æ¬¡å¯¹è¯/æµç¨‹ç”Ÿæˆå¹¶å¤ç”¨ thread_id
import { randomUUID } from 'node:crypto';

const threadId = randomUUID();

// è°ƒç”¨å›¾æ—¶å°† thread_id æ”¾å…¥ configurableï¼Œç¡®ä¿åŒä¸€çº¿ç¨‹å¯ç»§ç»­æ‰§è¡Œ
const result = await graph.invoke(input, {
  configurable: { thread_id: threadId },
});

// åç»­è¯·æ±‚ç»§ç»­å¤ç”¨åŒä¸€ä¸ª thread_idï¼Œå³å¯åœ¨åŒä¸€çŠ¶æ€é“¾ä¸Šæ¨è¿›
await graph.invoke(nextInput, { configurable: { thread_id: threadId } });
```

#### æ£€æŸ¥ç‚¹ï¼ˆCheckpointï¼‰

æ£€æŸ¥ç‚¹åŒ…å«å®Œæ•´çš„çŠ¶æ€ä¿¡æ¯å’Œå…ƒæ•°æ®ï¼ŒåŒ…æ‹¬ï¼š

- **çŠ¶æ€å¿«ç…§**ï¼šå½“å‰å›¾çš„å®Œæ•´çŠ¶æ€
- **æ‰§è¡Œä½ç½®**ï¼šä¸‹ä¸€ä¸ªè¦æ‰§è¡Œçš„èŠ‚ç‚¹
- **å…ƒæ•°æ®**ï¼šæ—¶é—´æˆ³ã€é…ç½®ä¿¡æ¯ç­‰
- **å†å²è®°å½•**ï¼šçŠ¶æ€å˜æ›´çš„å®Œæ•´é“¾æ¡

```typescript
// æ£€æŸ¥ç‚¹ç®¡ç†ï¼šä¸ºå›¾é…ç½®æ£€æŸ¥ç‚¹å™¨ï¼ˆæŒä¹…åŒ–åç«¯ï¼‰
import { MemorySaver } from '@langchain/langgraph';
import { SqliteSaver } from '@langchain/langgraph-checkpoint-sqlite';
import { PostgresSaver } from '@langchain/langgraph-checkpoint-postgres';

// å¼€å‘æœŸï¼šå†…å­˜åç«¯ï¼ˆé‡å¯ä¸¢å¤±ï¼Œæœ€å¿«ï¼‰
const devCheckpointer = new MemorySaver();

// æœ¬åœ°/å°å‹é¡¹ç›®ï¼šSQLite æ–‡ä»¶æŒä¹…åŒ–
const sqliteCheckpointer = new SqliteSaver({ filename: './state.db' });

// ç”Ÿäº§ï¼šPostgres æŒä¹…åŒ–
const pgCheckpointer = new PostgresSaver(process.env.DATABASE_URL!);

// é€‰æ‹©ä¸€ä¸ªåç«¯ç¼–è¯‘å·¥ä½œæµ
const graph = workflow.compile({ checkpointer: pgCheckpointer });
```

### çŠ¶æ€æŸ¥è¯¢å’Œå†å²

æŒä¹…åŒ–æœºåˆ¶æä¾›äº†å¼ºå¤§çš„çŠ¶æ€æŸ¥è¯¢èƒ½åŠ›ï¼Œå…è®¸ä½ ï¼š

- è·å–å½“å‰çŠ¶æ€å¿«ç…§
- æŸ¥çœ‹å®Œæ•´çš„æ‰§è¡Œå†å²
- å›æº¯åˆ°ä»»æ„å†å²çŠ¶æ€
- åˆ†æçŠ¶æ€å˜æ›´è½¨è¿¹

```typescript
// çŠ¶æ€æŸ¥è¯¢ä¸å†å²ï¼šæŸ¥è¯¢å½“å‰çŠ¶æ€ä¸å†å²æ£€æŸ¥ç‚¹
const threadId = 'your-thread-id';

// è·å–å½“å‰çŠ¶æ€ï¼ˆç¤ºä¾‹ APIï¼Œå…·ä½“ä»¥å®é™…ç‰ˆæœ¬ä¸ºå‡†ï¼‰
const currentState = await graph.getState({
  configurable: { thread_id: threadId },
});
console.log('values:', currentState.values);
console.log('metadata:', currentState.metadata);

// åˆ—å‡ºå†å²æ£€æŸ¥ç‚¹ï¼ˆç¤ºä¾‹ APIï¼‰
const checkpoints = await checkpointer.list({ thread_id: threadId });
console.log('history length:', checkpoints.length);
```

## ğŸ—„ï¸ å­˜å‚¨åç«¯é€‰æ‹©

LangGraphJS æä¾›å¤šç§å­˜å‚¨åç«¯ï¼Œé€‚ç”¨äºä¸åŒçš„ä½¿ç”¨åœºæ™¯ã€‚é€‰æ‹©åˆé€‚çš„å­˜å‚¨åç«¯æ˜¯æ„å»ºå¯é æŒä¹…åŒ–ç³»ç»Ÿçš„å…³é”®ã€‚


### å­˜å‚¨åç«¯ç‰¹æ€§å¯¹æ¯”

ä¸åŒå­˜å‚¨åç«¯é€‚ç”¨äºä¸åŒçš„åº”ç”¨åœºæ™¯ï¼š

| å­˜å‚¨ç±»å‹      | é€‚ç”¨åœºæ™¯ | ä¼˜ç‚¹               | ç¼ºç‚¹               | æ€§èƒ½ |
| ------------- | -------- | ------------------ | ------------------ | ---- |
| MemorySaver   | å¼€å‘æµ‹è¯• | ç®€å•å¿«é€Ÿï¼Œæ— éœ€é…ç½® | é‡å¯ä¸¢å¤±ï¼Œå†…å­˜é™åˆ¶ | æé«˜ |
| SqliteSaver   | æœ¬åœ°åº”ç”¨ | è½»é‡çº§ï¼Œæ–‡ä»¶å­˜å‚¨   | å•æœºé™åˆ¶ï¼Œå¹¶å‘æœ‰é™ | é«˜   |
| PostgresSaver | ç”Ÿäº§ç¯å¢ƒ | é«˜æ€§èƒ½ï¼Œé«˜å¯ç”¨     | é…ç½®å¤æ‚ï¼Œèµ„æºæ¶ˆè€— | å¾ˆé«˜ |


## ğŸ­ ç”Ÿäº§ç¯å¢ƒé…ç½®

åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œéœ€è¦è€ƒè™‘æ€§èƒ½ã€å¯é æ€§å’Œæ‰©å±•æ€§ï¼š

```typescript
// ç”Ÿäº§ç¯å¢ƒæŒä¹…åŒ–é…ç½®ï¼ˆç¤ºä¾‹ï¼‰
import { PostgresSaver } from '@langchain/langgraph-checkpoint-postgres';

const checkpointer = new PostgresSaver(process.env.DATABASE_URL!, {
  pool: { min: 2, max: 10 },
  statementTimeoutMs: 10_000,
});

const graph = workflow.compile({
  checkpointer
});
```

## ğŸ“Š æŒä¹…åŒ–å·¥ä½œæµç¨‹

```mermaid
sequenceDiagram
    participant ç”¨æˆ·
    participant åº”ç”¨
    participant æ£€æŸ¥ç‚¹å™¨
    participant å­˜å‚¨åç«¯

    ç”¨æˆ·->>åº”ç”¨: å‘é€è¯·æ±‚
    åº”ç”¨->>æ£€æŸ¥ç‚¹å™¨: æ£€æŸ¥ç°æœ‰çŠ¶æ€
    æ£€æŸ¥ç‚¹å™¨->>å­˜å‚¨åç«¯: æŸ¥è¯¢æ£€æŸ¥ç‚¹
    å­˜å‚¨åç«¯-->>æ£€æŸ¥ç‚¹å™¨: è¿”å›çŠ¶æ€
    æ£€æŸ¥ç‚¹å™¨-->>åº”ç”¨: åŠ è½½çŠ¶æ€

    åº”ç”¨->>åº”ç”¨: æ‰§è¡ŒèŠ‚ç‚¹é€»è¾‘

    åº”ç”¨->>æ£€æŸ¥ç‚¹å™¨: ä¿å­˜æ–°çŠ¶æ€
    æ£€æŸ¥ç‚¹å™¨->>å­˜å‚¨åç«¯: å†™å…¥æ£€æŸ¥ç‚¹
    å­˜å‚¨åç«¯-->>æ£€æŸ¥ç‚¹å™¨: ç¡®è®¤ä¿å­˜

    åº”ç”¨-->>ç”¨æˆ·: è¿”å›ç»“æœ

    note over æ£€æŸ¥ç‚¹å™¨: æ¯ä¸ªæ­¥éª¤åè‡ªåŠ¨ä¿å­˜
    note over å­˜å‚¨åç«¯: æ”¯æŒå¤šç§å­˜å‚¨æ–¹æ¡ˆ
```

 

## ğŸ¯ å®è·µæ¡ˆä¾‹ï¼šæ”¯æŒæŒä¹…åŒ–çš„å›¾


```typescript
import { ChatOpenAI } from '@langchain/openai'
import './lib/loadEnv'
import { Annotation, StateGraph } from '@langchain/langgraph'
import { BaseMessage, HumanMessage } from '@langchain/core/messages'
import { randomUUID } from 'node:crypto';
import { MemorySaver } from '@langchain/langgraph';
const devCheckpointer = new MemorySaver();

const llm = new ChatOpenAI({
    model: 'qwen3-max',
})



const StateAnnotation = Annotation.Root({
    messages: Annotation<BaseMessage[]>({
        reducer: (oldState, newState) => {
            return [...oldState, ...newState]
        },
        default: () => []
    }),
})

const llmNode = async (state: typeof StateAnnotation.State) => {
    const response = await llm.invoke(state.messages)
    return {
        messages: [response]
    }
}



const graph = new StateGraph(StateAnnotation)
    .addNode('llmNode', llmNode)
    .addEdge('__start__', 'llmNode')
    .addEdge('llmNode', '__end__')
    .compile({ checkpointer: devCheckpointer })


const logMessages = (messages: BaseMessage[]) => {
    messages.forEach((msg) => {
        console.log(`%c Line:44 ğŸ¥’ ã€${msg.getType()}ã€‘`, "color:#2eafb0", msg.content);
    });
}

async function runDemo() {
    try {
        const threadId = randomUUID();

        console.log("%c Line:62 ğŸª==============ç¬¬ä¸€è½®å¯¹è¯============", "color:#7f2b82");

        await graph.invoke({
            messages: [
                new HumanMessage('ä¸­å›½é¦–éƒ½åœ¨å“ªé‡Œ'),
            ]
        }, {
            configurable: {
                thread_id: threadId
            }
        }).then(res => {
            logMessages(res.messages)
        })

        console.log("%c Line:62 ğŸª==============ç¬¬äºŒè½®å¯¹è¯============", "color:#7f2b82");

        await graph.invoke({
            messages: [
                new HumanMessage('ä¸Šä¸€ä¸ªé—®é¢˜é—®çš„æ˜¯ä»€ä¹ˆ'),
            ]
        }, {
            configurable: {
                thread_id: threadId
            }
        }).then(res => {
            logMessages(res.messages)
        })


    } catch (error) {
        console.error("é”™è¯¯:", error);
    }
}

runDemo()
```
 
## ğŸ”— ç›¸å…³èµ„æº

- [çŠ¶æ€ç®¡ç†](../æ ¸å¿ƒç»„ä»¶è¯¦è§£/çŠ¶æ€ç®¡ç†) - äº†è§£çŠ¶æ€åœ¨æŒä¹…åŒ–ä¸­çš„ä½œç”¨
- [è®°å¿†ç®¡ç†](./è®°å¿†ç®¡ç†) - å­¦ä¹ å¦‚ä½•ç»“åˆè®°å¿†å’ŒæŒä¹…åŒ–
- [äººæœºäº¤äº’](./äººæœºäº¤äº’) - ç†è§£æŒä¹…åŒ–åœ¨äº¤äº’ä¸­çš„é‡è¦æ€§

æŒä¹…åŒ–æ˜¯æ„å»ºå¯é  AI åº”ç”¨çš„åŸºç¡€è®¾æ–½ã€‚é€šè¿‡åˆç†ä½¿ç”¨æ£€æŸ¥ç‚¹æœºåˆ¶ï¼Œä½ å¯ä»¥åˆ›å»ºå‡ºæ—¢ç¨³å®šåˆçµæ´»çš„åº”ç”¨ï¼Œä¸ºç”¨æˆ·æä¾›æ— ç¼çš„ä½“éªŒã€‚è¿™ä¸ºå®ç°æ›´å¤æ‚çš„åŠŸèƒ½å¦‚äººæœºäº¤äº’å’Œæµå¼å¤„ç†å¥ å®šäº†åšå®çš„åŸºç¡€ã€‚
