---
title: è®°å¿†ç®¡ç†
subtitle: åŸºäº LangGraphJS çš„è®°å¿†ç®¡ç†æœºåˆ¶
---

# ğŸ§  è®°å¿†ç®¡ç†

<div class="abs-br m-6 flex items-center">
  <span class="text-xl"> @langgraphjs/memory </span>
</div>

<!--
å¤§å®¶å¥½ï¼ä»Šå¤©æˆ‘å¾ˆé«˜å…´ä¸å¤§å®¶åˆ†äº« LangGraphJS ä¸­çš„è®°å¿†ç®¡ç†æœºåˆ¶ã€‚

åœ¨æ„å»ºç°ä»£ AI åº”ç”¨æ—¶ï¼Œè®°å¿†ç®¡ç†æ˜¯ä¸€ä¸ªè‡³å…³é‡è¦çš„åŠŸèƒ½ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœä½ çš„æ™ºèƒ½åŠ©æ‰‹æ¯æ¬¡å¯¹è¯éƒ½å¿˜è®°ä¹‹å‰è¯´è¿‡ä»€ä¹ˆï¼Œé‚£å°†æ˜¯å¤šä¹ˆç³Ÿç³•çš„ç”¨æˆ·ä½“éªŒã€‚å°±åƒäººç±»èƒ½å¤Ÿè®°ä½è¿‡å»çš„å¯¹è¯å’Œç»éªŒä¸€æ ·ï¼ŒAI åº”ç”¨ä¹Ÿéœ€è¦èƒ½å¤Ÿä¿å­˜å’Œå›å¿†ä¿¡æ¯ã€‚

ä»Šå¤©çš„åˆ†äº«å°†å¸®åŠ©å¤§å®¶æ·±å…¥ç†è§£ LangGraphJS æä¾›çš„å¼ºå¤§è®°å¿†ç®¡ç†æœºåˆ¶ï¼Œå­¦ä¹ å¦‚ä½•æ„å»ºå…·æœ‰æ™ºèƒ½è®°å¿†èƒ½åŠ›çš„ AI åº”ç”¨ï¼Œè®©ä½ çš„åº”ç”¨èƒ½å¤Ÿåœ¨å¯¹è¯ä¸­ä¿æŒä¸Šä¸‹æ–‡ï¼Œå¹¶åœ¨ä¸åŒä¼šè¯é—´å…±äº«çŸ¥è¯†ã€‚

æˆ‘ä»¬å°†ä»åŸºæœ¬æ¦‚å¿µå¼€å§‹ï¼Œé€æ­¥æ·±å…¥åˆ°å®é™…åº”ç”¨å’Œæœ€ä½³å®è·µï¼Œç›¸ä¿¡é€šè¿‡ä»Šå¤©çš„åˆ†äº«ï¼Œå¤§å®¶éƒ½èƒ½æŒæ¡æ„å»ºçœŸæ­£æ™ºèƒ½ AI åº”ç”¨çš„æ ¸å¿ƒæŠ€æœ¯ã€‚
-->

---
layout: two-cols
---

# ğŸ¯ è®°å¿†ç®¡ç†æ¦‚è¿°

ä»å‰ç«¯å¼€å‘çš„è§’åº¦æ¥ç†è§£è®°å¿†ç®¡ç†ï¼š

- **çŸ­æœŸè®°å¿†** ç±»ä¼¼äº `sessionStorage`
- **é•¿æœŸè®°å¿†** ç±»ä¼¼äº `localStorage`
- **æ£€æŸ¥ç‚¹æœºåˆ¶** ç±»ä¼¼äºè‡ªåŠ¨ä¿å­˜åŠŸèƒ½

<br>

<v-click>

## æ ¸å¿ƒæ¦‚å¿µ

- çº¿ç¨‹çº§åˆ«çš„çŠ¶æ€ç®¡ç†
- è·¨çº¿ç¨‹çš„ä¿¡æ¯å…±äº«
- æ™ºèƒ½åŒ–çš„æ•°æ®æŒä¹…åŒ–

</v-click>

::right::

```mermaid
graph TD
    A[ç”¨æˆ·äº¤äº’] --> B{è®°å¿†ç±»å‹}
    B -->|å•æ¬¡å¯¹è¯| C[çŸ­æœŸè®°å¿†]
    B -->|è·¨å¯¹è¯| D[é•¿æœŸè®°å¿†]

    C --> E[çº¿ç¨‹çŠ¶æ€]
    C --> F[å¯¹è¯å†å²]
    C --> G[ä¸´æ—¶æ•°æ®]

    D --> H[ç”¨æˆ·åå¥½]
    D --> I[å­¦ä¹ è§„åˆ™]
    D --> J[å†å²ç»éªŒ]

    E --> K[æ£€æŸ¥ç‚¹å­˜å‚¨]
    F --> K
    G --> K

    H --> L[Memory Store]
    I --> L
    J --> L

    classDef default fill:#f2f0ff;
    classDef memory fill:#e1f5fe;
    classDef storage fill:#f3e5f5;

    class C,D memory;
    class K,L storage;
```

<!--
é¦–å…ˆè®©æˆ‘ä»¬æ¥ç†è§£ä»€ä¹ˆæ˜¯è®°å¿†ç®¡ç†ã€‚

ä½œä¸ºå‰ç«¯å¼€å‘è€…ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å¾ˆç†Ÿæ‚‰çš„æµè§ˆå™¨å­˜å‚¨æœºåˆ¶æ¥ç±»æ¯”ç†è§£ LangGraphJS çš„è®°å¿†ç®¡ç†ã€‚çŸ­æœŸè®°å¿†å°±åƒæ˜¯æµè§ˆå™¨çš„ sessionStorageï¼Œå®ƒåœ¨å•æ¬¡ä¼šè¯ä¸­ä¿æŒæ•°æ®ï¼Œä¸€æ—¦ä¼šè¯ç»“æŸå°±æ¸…ç©ºã€‚è€Œé•¿æœŸè®°å¿†åˆ™ç±»ä¼¼äº localStorageï¼Œå®ƒå¯ä»¥è·¨ä¼šè¯æŒä¹…åŒ–æ•°æ®ï¼Œå³ä½¿åº”ç”¨é‡å¯åæ•°æ®ä¾ç„¶å­˜åœ¨ã€‚

æ£€æŸ¥ç‚¹æœºåˆ¶å°±åƒæ˜¯è‡ªåŠ¨ä¿å­˜åŠŸèƒ½ï¼Œå®ƒä¼šå®šæœŸä¿å­˜åº”ç”¨çš„çŠ¶æ€ï¼Œç¡®ä¿åœ¨æ„å¤–æƒ…å†µä¸‹ä¸ä¼šä¸¢å¤±é‡è¦çš„å¯¹è¯ä¿¡æ¯ã€‚

ç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹è¿™ä¸‰ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼š

çº¿ç¨‹çº§åˆ«çš„çŠ¶æ€ç®¡ç†æ„å‘³ç€æ¯ä¸ªå¯¹è¯çº¿ç¨‹éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„çŠ¶æ€ï¼Œä¸åŒçº¿ç¨‹ä¹‹é—´ä¸ä¼šç›¸äº’å¹²æ‰°ã€‚è·¨çº¿ç¨‹çš„ä¿¡æ¯å…±äº«åˆ™å…è®¸æŸäº›ä¿¡æ¯åœ¨ä¸åŒçš„å¯¹è¯ä¸­è¢«è®¿é—®å’Œä½¿ç”¨ã€‚è€Œæ™ºèƒ½åŒ–çš„æ•°æ®æŒä¹…åŒ–åˆ™ç¡®ä¿äº†æ•°æ®èƒ½å¤Ÿæ ¹æ®é‡è¦æ€§è¿›è¡Œåˆç†çš„å­˜å‚¨å’Œç®¡ç†ã€‚

å³è¾¹çš„æµç¨‹å›¾æ¸…æ™°åœ°å±•ç¤ºäº†æ•´ä¸ªè®°å¿†ç®¡ç†çš„æ¶æ„ã€‚ç”¨æˆ·äº¤äº’ä¼šæ ¹æ®ä¸åŒçš„åœºæ™¯é€‰æ‹©ä½¿ç”¨çŸ­æœŸè®°å¿†è¿˜æ˜¯é•¿æœŸè®°å¿†ã€‚å¦‚æœæ˜¯å•æ¬¡å¯¹è¯ä¸­çš„ä¿¡æ¯ï¼Œå°±ä¼šä½¿ç”¨çŸ­æœŸè®°å¿†æ¥ç®¡ç†çº¿ç¨‹çŠ¶æ€ã€å¯¹è¯å†å²å’Œä¸´æ—¶æ•°æ®ã€‚è¿™äº›ä¿¡æ¯æœ€ç»ˆä¼šå­˜å‚¨åˆ°æ£€æŸ¥ç‚¹å­˜å‚¨ä¸­ã€‚

è€Œå¦‚æœæ˜¯éœ€è¦è·¨å¯¹è¯å…±äº«çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ç”¨æˆ·åå¥½ã€å­¦ä¹ è§„åˆ™å’Œå†å²ç»éªŒï¼Œå°±ä¼šä½¿ç”¨é•¿æœŸè®°å¿†ï¼Œé€šè¿‡ Memory Store æ¥è¿›è¡Œç®¡ç†ã€‚

è¿™ç§è®¾è®¡è®©æˆ‘ä»¬çš„ AI åº”ç”¨èƒ½å¤ŸçœŸæ­£"è®°ä½"ç”¨æˆ·ï¼Œæä¾›ä¸ªæ€§åŒ–çš„æ™ºèƒ½ä½“éªŒã€‚
-->

---
layout: two-cols
---

# ğŸ“ çŸ­æœŸè®°å¿†

## Thread-Scoped Memory

åŸºäº LangGraphJS çš„æ£€æŸ¥ç‚¹æœºåˆ¶ï¼š

- **å¯¹è¯å†å²**ï¼šä¿å­˜å®Œæ•´çš„ç”¨æˆ·-åŠ©æ‰‹å¯¹è¯è®°å½•
- **ä¼šè¯çŠ¶æ€**ï¼šç»´æŠ¤å½“å‰å¯¹è¯çš„çŠ¶æ€å’Œè¿›åº¦
- **ä¸´æ—¶æ•°æ®**ï¼šå­˜å‚¨å¯¹è¯è¿‡ç¨‹ä¸­çš„ä¸´æ—¶ä¿¡æ¯
- **ä¸Šä¸‹æ–‡æ„ŸçŸ¥**ï¼šåŸºäºå†å²å¯¹è¯æä¾›ä¸ªæ€§åŒ–å›å¤

::right::

## æ ¸å¿ƒå®ç°

```typescript
// å¯¹è¯è®°å¿†ï¼šåŸºäº thread_id ç»´æŒå¯¹è¯ä¸Šä¸‹æ–‡ä¸å†å²
import { randomUUID } from 'node:crypto';

const threadId = randomUUID();

// ç”¨æˆ·é¦–æ¡æ¶ˆæ¯
await graph.invoke(
  { user: 'ä½ å¥½' },
  { configurable: { thread_id: threadId } }
);

// åç»­æ¶ˆæ¯ç»§ç»­å¤ç”¨åŒä¸€ thread_id
await graph.invoke(
  { user: 'è¯·å¸®æˆ‘æ¨èä¸€æ¬¾é”®ç›˜' },
  { configurable: { thread_id: threadId } }
);
```

<!--
æ¥ä¸‹æ¥æˆ‘ä»¬è¯¦ç»†çœ‹çœ‹çŸ­æœŸè®°å¿†ï¼Œä¹Ÿå°±æ˜¯ Thread-Scoped Memoryã€‚

çŸ­æœŸè®°å¿†æ˜¯ LangGraphJS åŸºäºæ£€æŸ¥ç‚¹æœºåˆ¶è®¾è®¡çš„ï¼Œä¸»è¦ç”¨äºç®¡ç†å•æ¬¡å¯¹è¯çº¿ç¨‹ä¸­çš„ä¿¡æ¯ã€‚å®ƒæœ‰å››ä¸ªä¸»è¦åŠŸèƒ½ï¼š

å¯¹è¯å†å²ä¿å­˜åŠŸèƒ½å¯ä»¥å®Œæ•´è®°å½•ç”¨æˆ·å’ŒåŠ©æ‰‹ä¹‹é—´çš„æ‰€æœ‰å¯¹è¯ï¼Œè¿™æ ·åœ¨å¯¹è¯è¿‡ç¨‹ä¸­ï¼ŒAI å¯ä»¥å›é¡¾ä¹‹å‰è¯´äº†ä»€ä¹ˆï¼Œç”¨æˆ·é—®äº†ä»€ä¹ˆï¼Œä»è€Œä¿æŒå¯¹è¯çš„è¿è´¯æ€§å’Œé€»è¾‘æ€§ã€‚

ä¼šè¯çŠ¶æ€ç®¡ç†åˆ™ç»´æŠ¤ç€å½“å‰å¯¹è¯çš„çŠ¶æ€å’Œè¿›åº¦ï¼Œæ¯”å¦‚æˆ‘ä»¬èŠåˆ°å“ªä¸ªè¯é¢˜äº†ï¼Œè®¨è®ºè¿›è¡Œåˆ°ä»€ä¹ˆé˜¶æ®µäº†ï¼Œæœ‰æ²¡æœ‰ä»€ä¹ˆå¾…åŠäº‹é¡¹ç­‰ç­‰ã€‚

ä¸´æ—¶æ•°æ®å­˜å‚¨åŠŸèƒ½å…è®¸æˆ‘ä»¬åœ¨å¯¹è¯è¿‡ç¨‹ä¸­ä¿å­˜ä¸€äº›ä¸´æ—¶çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ç”¨æˆ·æåˆ°çš„æŸäº›å‚æ•°ã€ä¸­é—´è®¡ç®—ç»“æœç­‰ã€‚

æœ€é‡è¦çš„åŠŸèƒ½æ˜¯ä¸Šä¸‹æ–‡æ„ŸçŸ¥ï¼ŒåŸºäºå†å²å¯¹è¯å†…å®¹ï¼ŒAI å¯ä»¥æä¾›æ›´åŠ ä¸ªæ€§åŒ–å’Œç›¸å…³çš„å›å¤ã€‚

å³è¾¹çš„ä»£ç å±•ç¤ºäº†çŸ­æœŸè®°å¿†çš„æ ¸å¿ƒå®ç°æ–¹å¼ã€‚æˆ‘ä»¬ä½¿ç”¨ thread_id æ¥æ ‡è¯†æ¯ä¸ªå¯¹è¯çº¿ç¨‹ï¼Œè¿™æ ·åŒä¸€å¯¹è¯ä¸­çš„æ‰€æœ‰æ¶ˆæ¯éƒ½ä¼šå…±äº«åŒä¸€ä¸ª thread_idã€‚

é¦–å…ˆæˆ‘ä»¬ç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„ thread_idï¼Œç„¶åç”¨æˆ·å‘é€ç¬¬ä¸€æ¡æ¶ˆæ¯æ—¶ï¼Œæˆ‘ä»¬å°†è¿™ä¸ª thread_id é…ç½®ä¼ é€’ç»™å›¾æ‰§è¡Œå™¨ã€‚å½“ç”¨æˆ·ç»§ç»­å‘é€æ¶ˆæ¯æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨ç›¸åŒçš„ thread_idï¼Œè¿™æ ·å°±èƒ½åœ¨åŒä¸€ä¸Šä¸‹æ–‡ä¸­è¿›è¡Œå¯¹è¯ã€‚

åœ¨èŠ‚ç‚¹çš„å†…éƒ¨ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šå°†æ–°çš„æ¶ˆæ¯è¿½åŠ åˆ°çŠ¶æ€çš„æ¶ˆæ¯æ•°ç»„ä¸­ï¼Œè¿™æ ·å°±èƒ½ä¿æŒå¯¹è¯çš„å®Œæ•´æ€§ã€‚

è¿™ç§æœºåˆ¶ç¡®ä¿äº†åœ¨å•æ¬¡å¯¹è¯ä¸­ï¼ŒAI èƒ½å¤Ÿè®°ä½ä¹‹å‰è¯´çš„å†…å®¹ï¼Œæä¾›è¿è´¯çš„å¯¹è¯ä½“éªŒã€‚
-->

---
layout: two-cols
---

# ğŸ“ çŸ­æœŸè®°å¿†ä¼˜åŒ–

## å¯¹è¯å†å²ç®¡ç†

åœ¨é•¿å¯¹è¯ä¸­æ™ºèƒ½ç®¡ç†å†å²ï¼š

- **å†å²è£å‰ª**ï¼šä¿ç•™æœ€é‡è¦çš„å¯¹è¯ç‰‡æ®µ
- **æ‘˜è¦ç”Ÿæˆ**ï¼šå°†é•¿å¯¹è¯å‹ç¼©ä¸ºå…³é”®ä¿¡æ¯
- **ä¸Šä¸‹æ–‡çª—å£**ï¼šåŠ¨æ€è°ƒæ•´è®°å¿†çš„èŒƒå›´
- **é‡è¦æ€§è¯„åˆ†**ï¼šè¯†åˆ«å’Œä¿ç•™å…³é”®å¯¹è¯å†…å®¹

::right::

## ä¼˜åŒ–å®ç°

```typescript
// å¯¹è¯å†å²ä¼˜åŒ–ï¼šè£å‰ªä¸æ‘˜è¦
type Message = {
  role: 'user' | 'assistant';
  content: string
};

function trimHistory(
  messages: Message[],
  keepLatest: number = 20
): Message[] {
  if (messages.length <= keepLatest)
    return messages;
  return messages.slice(-keepLatest);
}

async function summarize(
  messages: Message[]
): Promise<Message[]> {
  // å°†æ›´æ—©çš„å†å²åšæˆä¸€æ¡æ‘˜è¦
  if (messages.length < 40) return messages;
  const older = messages.slice(0, -20);
  const recent = messages.slice(-20);
  const summary = {
    role: 'assistant',
    content: `å†å²æ‘˜è¦(${older.length}æ¡)`
  };
  return [summary, ...recent];
}
```

<!--
åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå¯¹è¯å¯èƒ½ä¼šå˜å¾—å¾ˆé•¿ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å°±éœ€è¦å¯¹å¯¹è¯å†å²è¿›è¡Œæ™ºèƒ½ç®¡ç†ã€‚

å·¦è¾¹çš„åˆ—è¡¨å±•ç¤ºäº†å››ç§ä¸»è¦çš„å¯¹è¯å†å²ç®¡ç†ç­–ç•¥ï¼š

å†å²è£å‰ªç­–ç•¥ä¼šä¿ç•™æœ€é‡è¦çš„å¯¹è¯ç‰‡æ®µï¼Œåˆ é™¤é‚£äº›ç›¸å¯¹ä¸é‚£ä¹ˆé‡è¦çš„å†…å®¹ã€‚è¿™éœ€è¦æˆ‘ä»¬å»ºç«‹ä¸€å¥—è¯„ä¼°æœºåˆ¶ï¼Œåˆ¤æ–­å“ªäº›å¯¹è¯å†…å®¹æ›´é‡è¦ã€‚

æ‘˜è¦ç”Ÿæˆç­–ç•¥åˆ™é€šè¿‡å°†é•¿å¯¹è¯å‹ç¼©ä¸ºå…³é”®ä¿¡æ¯ï¼Œä¿ç•™å¯¹è¯çš„ç²¾åå†…å®¹ã€‚è¿™å¯¹äºé‚£äº›éœ€è¦å›é¡¾æ•´ä¸ªå¯¹è¯å†å²çš„åœºæ™¯ç‰¹åˆ«æœ‰ç”¨ã€‚

ä¸Šä¸‹æ–‡çª—å£ç­–ç•¥å¯ä»¥åŠ¨æ€è°ƒæ•´è®°å¿†çš„èŒƒå›´ï¼Œæ ¹æ®å¯¹è¯çš„å¤æ‚ç¨‹åº¦å’Œé‡è¦ç¨‹åº¦æ¥å†³å®šä¿ç•™å¤šå°‘å†å²ä¿¡æ¯ã€‚

é‡è¦æ€§è¯„åˆ†ç­–ç•¥é€šè¿‡ç®—æ³•è¯†åˆ«å’Œä¿ç•™å…³é”®å¯¹è¯å†…å®¹ï¼Œç¡®ä¿é‡è¦çš„ä¿¡æ¯ä¸ä¼šè¢«æ„å¤–åˆ é™¤ã€‚

å³è¾¹çš„ä»£ç å±•ç¤ºäº†å…·ä½“çš„å®ç°æ–¹å¼ã€‚trimHistory å‡½æ•°æ˜¯ä¸€ä¸ªç®€å•çš„å†å²è£å‰ªå®ç°ï¼Œå®ƒä¿ç•™æœ€æ–°çš„æŒ‡å®šæ•°é‡çš„æ¶ˆæ¯ã€‚å½“æ¶ˆæ¯æ•°é‡è¶…è¿‡é™åˆ¶æ—¶ï¼Œå°±åªä¿ç•™æœ€æ–°çš„å‡ æ¡ã€‚

summarize å‡½æ•°åˆ™æ˜¯ä¸€ä¸ªæ›´é«˜çº§çš„ç­–ç•¥ã€‚å½“æ¶ˆæ¯æ•°é‡è¶…è¿‡ 40 æ¡æ—¶ï¼Œå®ƒä¼šæŠŠæ—©æœŸçš„æ¶ˆæ¯å‹ç¼©æˆä¸€æ¡æ‘˜è¦ï¼Œç„¶åä¿ç•™æœ€è¿‘çš„ 20 æ¡æ¶ˆæ¯ã€‚è¿™æ ·æ—¢ä¿ç•™äº†å†å²ä¿¡æ¯çš„æ¦‚è¦ï¼Œåˆç¡®ä¿äº†æœ€è¿‘å¯¹è¯çš„å®Œæ•´æ€§ã€‚

åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç»“åˆè¿™äº›ç­–ç•¥ï¼Œæ ¹æ®åº”ç”¨çš„å…·ä½“éœ€æ±‚æ¥è®¾è®¡æœ€åˆé€‚çš„å†å²ç®¡ç†æ–¹æ¡ˆã€‚æ¯”å¦‚å¯¹äºå®¢æœæœºå™¨äººï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦æ›´ç§¯æåœ°ä¿ç•™ç”¨æˆ·çš„é—®é¢˜ï¼›å¯¹äºèŠå¤©åŠ©æ‰‹ï¼Œæˆ‘ä»¬å¯èƒ½æ›´æ³¨é‡å¯¹è¯çš„æµç•…æ€§ã€‚

æ™ºèƒ½çš„å†å²ç®¡ç†ç¡®ä¿äº†å³ä½¿åœ¨å¾ˆé•¿çš„å¯¹è¯ä¸­ï¼ŒAI ä¾ç„¶èƒ½å¤Ÿä¿æŒé«˜æ•ˆå’Œé«˜è´¨é‡çš„äº¤äº’ã€‚
-->

---
layout: two-cols
---

# ğŸ—„ï¸ é•¿æœŸè®°å¿†

## Cross-Thread Memory

Memory Store æä¾›è·¨çº¿ç¨‹æ•°æ®ç®¡ç†ï¼š

- **å‘½åç©ºé—´ç®¡ç†**ï¼šå±‚æ¬¡åŒ–å‘½åç©ºé—´ç»„ç»‡è®°å¿†
- **é”®å€¼å­˜å‚¨**ï¼šçµæ´»çš„é”®å€¼å¯¹å­˜å‚¨æœºåˆ¶
- **æ•°æ®æŒä¹…åŒ–**ï¼šç¡®ä¿è®°å¿†åœ¨åº”ç”¨é‡å¯åå¯ç”¨
- **æŸ¥è¯¢å’Œæœç´¢**ï¼šæ”¯æŒå¤æ‚çš„æ•°æ®æŸ¥è¯¢å’Œæ£€ç´¢

::right::

## Memory Store API

```typescript
// Memory Storeï¼šè·¨çº¿ç¨‹é•¿æœŸè®°å¿†
type MemoryStore = {
  put: (ns: string, key: string, value: unknown) => Promise<void>;
  get: (ns: string, key: string) => Promise<unknown | undefined>;
  list: (ns: string, prefix?: string) => Promise<Record<string, unknown>>;
};

const store: MemoryStore = /* è·å–æˆ–å®ç° */ (null as any);

// å‘½åç©ºé—´å»ºè®®ï¼šapp/user/<userId>/prefs
await store.put(
  'app/user/42/prefs',
  'keyboardLayout',
  'Alice-Like'
);
const pref = await store.get(
  'app/user/42/prefs',
  'keyboardLayout'
);
```

<!--
ç°åœ¨è®©æˆ‘ä»¬æ¥äº†è§£é•¿æœŸè®°å¿†ï¼Œä¹Ÿå°±æ˜¯ Cross-Thread Memoryã€‚

Memory Store æ˜¯ LangGraphJS æä¾›çš„è·¨çº¿ç¨‹æ•°æ®ç®¡ç†æœºåˆ¶ï¼Œå®ƒæœ‰å››ä¸ªæ ¸å¿ƒåŠŸèƒ½ï¼š

å‘½åç©ºé—´ç®¡ç†åŠŸèƒ½ä½¿ç”¨å±‚æ¬¡åŒ–çš„å‘½åç©ºé—´æ¥ç»„ç»‡ä¸åŒç±»å‹çš„è®°å¿†ã€‚å°±åƒæ–‡ä»¶ç³»ç»Ÿæœ‰æ–‡ä»¶å¤¹ä¸€æ ·ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä¸åŒç±»å‹çš„æ•°æ®å­˜å‚¨åœ¨ä¸åŒçš„å‘½åç©ºé—´ä¸­ï¼Œé¿å…æ•°æ®æ··ä¹±ã€‚

é”®å€¼å­˜å‚¨æœºåˆ¶æä¾›äº†éå¸¸çµæ´»çš„æ•°æ®å­˜å‚¨æ–¹å¼ï¼Œä½ å¯ä»¥ç”¨ä»»ä½•å­—ç¬¦ä¸²ä½œä¸ºé”®åï¼Œå­˜å‚¨ä»»ä½•ç±»å‹çš„æ•°æ®ã€‚è¿™ç§è®¾è®¡è®©è®°å¿†ç®¡ç†å˜å¾—ç®€å•ç›´è§‚ã€‚

æ•°æ®æŒä¹…åŒ–åŠŸèƒ½ç¡®ä¿è®°å¿†åœ¨åº”ç”¨é‡å¯åä¾ç„¶å¯ç”¨ã€‚è¿™å¯¹äºé‚£äº›éœ€è¦é•¿æœŸä¿å­˜çš„ç”¨æˆ·ä¿¡æ¯å’Œå­¦ä¹ ç»“æœæ¥è¯´éå¸¸é‡è¦ã€‚

æŸ¥è¯¢å’Œæœç´¢åŠŸèƒ½æ”¯æŒå¤æ‚çš„æ•°æ®æŸ¥è¯¢å’Œæ£€ç´¢ï¼Œè®©æˆ‘ä»¬èƒ½å¤Ÿå¿«é€Ÿæ‰¾åˆ°éœ€è¦çš„ä¿¡æ¯ã€‚

å³è¾¹çš„ä»£ç å±•ç¤ºäº† Memory Store çš„åŸºæœ¬ APIã€‚å®ƒæä¾›äº†ä¸‰ä¸ªä¸»è¦æ–¹æ³•ï¼šput ç”¨äºå­˜å‚¨æ•°æ®ï¼Œget ç”¨äºè·å–æ•°æ®ï¼Œlist ç”¨äºåˆ—å‡ºæŒ‡å®šå‘½åç©ºé—´ä¸‹çš„æ‰€æœ‰æ•°æ®ã€‚

åœ¨ä½¿ç”¨æ—¶ï¼Œæˆ‘ä»¬å»ºè®®ä½¿ç”¨å±‚æ¬¡åŒ–çš„å‘½åç©ºé—´ç»“æ„ï¼Œæ¯”å¦‚ "app/user/42/prefs" è¿™æ ·çš„æ ¼å¼ï¼Œå…¶ä¸­ 42 æ˜¯ç”¨æˆ· IDï¼Œprefs è¡¨ç¤ºè¿™æ˜¯ç”¨æˆ·çš„åå¥½è®¾ç½®ã€‚

ä»£ç ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•å­˜å‚¨å’Œè·å–ç”¨æˆ·çš„é”®ç›˜å¸ƒå±€åå¥½ã€‚æˆ‘ä»¬ä½¿ç”¨ store.put æ–¹æ³•å°†åå¥½æ•°æ®å­˜å‚¨åˆ°æŒ‡å®šä½ç½®ï¼Œç„¶åç”¨ store.get æ–¹æ³•æ¥è¯»å–è¿™ä¸ªåå¥½ã€‚

é€šè¿‡é•¿æœŸè®°å¿†ï¼Œåº”ç”¨èƒ½å¤Ÿè·¨ä¼šè¯å­¦ä¹ å’Œç§¯ç´¯çŸ¥è¯†ï¼ŒçœŸæ­£å®ç°æ™ºèƒ½åŒ–çš„ä¸ªæ€§åŒ–æœåŠ¡ã€‚æ¯”å¦‚ç”¨æˆ·ç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶è®¾ç½®äº†æŸäº›åå¥½ï¼Œä¸‹æ¬¡å†ä½¿ç”¨æ—¶ï¼Œåº”ç”¨å°±èƒ½è®°ä½è¿™äº›åå¥½ï¼Œæä¾›æ›´åŠ è´´å¿ƒçš„æœåŠ¡ã€‚
-->

---
layout: two-cols
---

# ğŸ—„ï¸ è®°å¿†ç±»å‹ä¸åº”ç”¨

## è®°å¿†ç±»å‹

### ç”¨æˆ·åå¥½è®°å¿†
- ä¸ªäººå–œå¥½å’Œå…´è¶£
- äº¤äº’ä¹ æƒ¯å’Œæ¨¡å¼
- ä¸ªæ€§åŒ–è®¾ç½®

### å­¦ä¹ è§„åˆ™è®°å¿†
- AI è¡Œä¸ºè°ƒæ•´è§„åˆ™
- ç”¨æˆ·åé¦ˆå­¦ä¹ 
- åŠ¨æ€ç­–ç•¥ä¼˜åŒ–

### çŸ¥è¯†åº“è®°å¿†
- é¢†åŸŸä¸“ä¸šçŸ¥è¯†
- å¸¸è§é—®é¢˜è§£ç­”
- å†å²ç»éªŒæ€»ç»“

::right::

## å­˜å‚¨é…ç½®

| ç¯å¢ƒ | å­˜å‚¨æ–¹æ¡ˆ | ç‰¹ç‚¹ |
|------|----------|------|
| å¼€å‘ | å†…å­˜å­˜å‚¨ | å¿«é€Ÿå¼€å‘ï¼Œæ•°æ®æ˜“å¤± |
| æœ¬åœ° | SQLite | è½»é‡çº§ï¼Œæ–‡ä»¶æŒä¹…åŒ– |
| ç”Ÿäº§ | PostgreSQL | é«˜å¯ç”¨ï¼Œé«˜æ€§èƒ½ |

```typescript
// å­˜å‚¨é…ç½®ç¤ºä¾‹
const config = {
  development: {
    storage: 'memory',
    checkpoint: true
  },
  production: {
    storage: 'postgresql',
    checkpoint: true,
    backup: true
  }
};
```

<!--
é•¿æœŸè®°å¿†å¯ä»¥å­˜å‚¨å¤šç§ç±»å‹çš„ä¿¡æ¯ï¼Œå·¦è¾¹åˆ—å‡ºäº†ä¸‰ç§ä¸»è¦çš„è®°å¿†ç±»å‹ï¼š

ç”¨æˆ·åå¥½è®°å¿†ä¸»è¦åŒ…æ‹¬ä¸ªäººçš„å–œå¥½å’Œå…´è¶£ï¼Œæ¯”å¦‚ç”¨æˆ·å–œæ¬¢çš„é¢œè‰²ã€éŸ³ä¹é£æ ¼ã€é˜…è¯»åå¥½ç­‰ã€‚è¿˜åŒ…æ‹¬ç”¨æˆ·çš„äº¤äº’ä¹ æƒ¯å’Œæ¨¡å¼ï¼Œæ¯”å¦‚ç”¨æˆ·ä¹ æƒ¯åœ¨ä»€ä¹ˆæ—¶é—´ä½¿ç”¨åº”ç”¨ï¼Œå–œæ¬¢ä»€ä¹ˆæ ·çš„äº¤äº’æ–¹å¼ç­‰ã€‚ä»¥åŠä¸ªæ€§åŒ–çš„è®¾ç½®ï¼Œæ¯”å¦‚ç•Œé¢è¯­è¨€ã€å­—ä½“å¤§å°ã€é€šçŸ¥åå¥½ç­‰ã€‚

å­¦ä¹ è§„åˆ™è®°å¿†ä¸»è¦è®°å½• AI è¡Œä¸ºçš„è°ƒæ•´è§„åˆ™ï¼Œæ¯”å¦‚æ ¹æ®ç”¨æˆ·åé¦ˆè°ƒæ•´å›å¤çš„é£æ ¼å’Œè¯­æ°”ã€‚è¿˜åŒ…æ‹¬ç”¨æˆ·åé¦ˆå­¦ä¹ ï¼Œè®°å½•ç”¨æˆ·å¯¹æŸäº›å›å¤çš„è¯„ä»·ï¼Œä»¥ä¾¿åœ¨æœªæ¥çš„äº¤äº’ä¸­æä¾›æ›´å¥½çš„æœåŠ¡ã€‚ä»¥åŠåŠ¨æ€ç­–ç•¥ä¼˜åŒ–ï¼Œæ ¹æ®ç”¨æˆ·çš„å®é™…ä½¿ç”¨æƒ…å†µä¸æ–­ä¼˜åŒ– AI çš„è¡Œä¸ºç­–ç•¥ã€‚

çŸ¥è¯†åº“è®°å¿†åˆ™åŒ…æ‹¬é¢†åŸŸä¸“ä¸šçŸ¥è¯†ï¼Œæ¯”å¦‚ç‰¹å®šè¡Œä¸šçš„æŠ€æœ¯æœ¯è¯­ã€å¸¸è§é—®é¢˜ç­‰ã€‚è¿˜åŒ…æ‹¬å¸¸è§é—®é¢˜è§£ç­”ï¼Œè®°å½•ç”¨æˆ·ç»å¸¸é—®çš„é—®é¢˜å’Œæ ‡å‡†ç­”æ¡ˆã€‚ä»¥åŠå†å²ç»éªŒæ€»ç»“ï¼Œä»è¿‡å»çš„äº¤äº’ä¸­å­¦ä¹ åˆ°çš„ç»éªŒå’Œæ•™è®­ã€‚

å³è¾¹çš„è¡¨æ ¼å±•ç¤ºäº†ä¸åŒç¯å¢ƒä¸‹çš„å­˜å‚¨æ–¹æ¡ˆé€‰æ‹©ã€‚åœ¨å¼€å‘é˜¶æ®µï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨å†…å­˜å­˜å‚¨ï¼Œè¿™æ ·å¯ä»¥å¿«é€Ÿå¼€å‘å’Œæµ‹è¯•ï¼Œä½†æ•°æ®æ˜¯æ˜“å¤±çš„ã€‚å¯¹äºæœ¬åœ°åº”ç”¨ï¼ŒSQLite æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ï¼Œå®ƒè½»é‡çº§ä¸”æ”¯æŒæ–‡ä»¶æŒä¹…åŒ–ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼ŒPostgreSQL æä¾›äº†é«˜å¯ç”¨æ€§å’Œé«˜æ€§èƒ½ï¼Œæ˜¯ç†æƒ³çš„å­˜å‚¨æ–¹æ¡ˆã€‚

ä¸‹é¢çš„é…ç½®ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•æ ¹æ®ä¸åŒç¯å¢ƒè®¾ç½®å­˜å‚¨é…ç½®ã€‚å¼€å‘ç¯å¢ƒä½¿ç”¨å†…å­˜å­˜å‚¨å¹¶å¯ç”¨æ£€æŸ¥ç‚¹ï¼Œç”Ÿäº§ç¯å¢ƒåˆ™ä½¿ç”¨ PostgreSQLï¼ŒåŒæ—¶å¯ç”¨æ£€æŸ¥ç‚¹å’Œå¤‡ä»½åŠŸèƒ½ã€‚

æ ¹æ®ä¸åŒçš„åº”ç”¨åœºæ™¯å’Œç¯å¢ƒé€‰æ‹©åˆé€‚çš„å­˜å‚¨æ–¹æ¡ˆï¼Œèƒ½å¤Ÿç¡®ä¿è®°å¿†ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œå¯é æ€§ã€‚
-->

---
layout: two-cols
---

# ğŸ¯ å®è·µæ¡ˆä¾‹

## æ™ºèƒ½å®¢æœæœºå™¨äºº

ç»“åˆçŸ­æœŸè®°å¿†ä¸é•¿æœŸè®°å¿†ï¼š

```typescript
// æ™ºèƒ½å®¢æœæœºå™¨äººï¼ˆç®€åŒ–ï¼‰
type Ctx = {
  messages: { role: string; content: string }[];
  userId: string
};

async function assistant(ctx: Ctx) {
  // è¯»å–é•¿æœŸè®°å¿†ä¸­çš„ç”¨æˆ·åå¥½
  const prefs = await store.get(
    `app/user/${ctx.userId}/prefs`,
    'keyboardLayout'
  );

  // åŸºäºå¯¹è¯å†å²ä¸åå¥½ç”Ÿæˆå›å¤
  const lastUser = ctx.messages
    .filter(m => m.role === 'user')
    .at(-1)?.content ?? '';

  return `ä¸ºä½ æ¨èåŸºäºåå¥½(${
    prefs ?? 'é»˜è®¤'
  })çš„é”®ç›˜æ–¹æ¡ˆï¼šâ€¦â€¦\nä½ åˆšæ‰è¯´ï¼š${lastUser}`;
}
```

::right::

## è®°å¿†æµç¨‹å›¾

```mermaid
sequenceDiagram
    participant ç”¨æˆ·
    participant åº”ç”¨
    participant çŸ­æœŸè®°å¿†
    participant é•¿æœŸè®°å¿†
    participant å­˜å‚¨åç«¯

    ç”¨æˆ·->>åº”ç”¨: å‘é€æ¶ˆæ¯
    åº”ç”¨->>çŸ­æœŸè®°å¿†: è·å–å¯¹è¯å†å²
    çŸ­æœŸè®°å¿†-->>åº”ç”¨: è¿”å›å†å²æ¶ˆæ¯

    åº”ç”¨->>é•¿æœŸè®°å¿†: æŸ¥è¯¢ç”¨æˆ·åå¥½
    é•¿æœŸè®°å¿†-->>åº”ç”¨: è¿”å›åå¥½ä¿¡æ¯

    åº”ç”¨->>åº”ç”¨: å¤„ç†æ¶ˆæ¯å¹¶ç”Ÿæˆå›å¤

    åº”ç”¨->>çŸ­æœŸè®°å¿†: ä¿å­˜æ–°æ¶ˆæ¯
    çŸ­æœŸè®°å¿†->>å­˜å‚¨åç«¯: åˆ›å»ºæ£€æŸ¥ç‚¹

    åº”ç”¨->>é•¿æœŸè®°å¿†: æ›´æ–°ç”¨æˆ·ä¿¡æ¯
    é•¿æœŸè®°å¿†->>å­˜å‚¨åç«¯: ä¿å­˜åˆ° Store

    åº”ç”¨-->>ç”¨æˆ·: è¿”å›ä¸ªæ€§åŒ–å›å¤

    note over çŸ­æœŸè®°å¿†: çº¿ç¨‹çº§åˆ«çš„çŠ¶æ€ç®¡ç†
    note over é•¿æœŸè®°å¿†: è·¨çº¿ç¨‹çš„ä¿¡æ¯å…±äº«
```

<!--
ç°åœ¨è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå…·ä½“çš„å®è·µæ¡ˆä¾‹æ¥çœ‹çœ‹å¦‚ä½•ç»“åˆçŸ­æœŸè®°å¿†å’Œé•¿æœŸè®°å¿†ã€‚

å·¦è¾¹çš„ä»£ç å±•ç¤ºäº†ä¸€ä¸ªæ™ºèƒ½å®¢æœæœºå™¨äººçš„ç®€åŒ–å®ç°ã€‚è¿™ä¸ªä¾‹å­å¾ˆå¥½åœ°å±•ç¤ºäº†å¦‚ä½•åœ¨å®é™…åº”ç”¨ä¸­ä½¿ç”¨è®°å¿†ç®¡ç†ã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸Šä¸‹æ–‡ç±»å‹ Ctxï¼Œå®ƒåŒ…å«äº†æ¶ˆæ¯æ•°ç»„å’Œç”¨æˆ· IDã€‚åœ¨ assistant å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆä»é•¿æœŸè®°å¿†ä¸­è¯»å–ç”¨æˆ·çš„åå¥½è®¾ç½®ï¼Œè¿™é‡Œæˆ‘ä»¬è¯»å–çš„æ˜¯é”®ç›˜å¸ƒå±€åå¥½ã€‚

ç„¶åæˆ‘ä»¬ä»å¯¹è¯å†å²ä¸­è·å–ç”¨æˆ·æœ€æ–°çš„æ¶ˆæ¯å†…å®¹ã€‚è¿™é‡Œæˆ‘ä»¬è¿‡æ»¤å‡ºç”¨æˆ·è§’è‰²ä¸º 'user' çš„æ¶ˆæ¯ï¼Œå¹¶å–æœ€åä¸€æ¡æ¶ˆæ¯çš„å†…å®¹ã€‚

æœ€åï¼Œæˆ‘ä»¬åŸºäºç”¨æˆ·çš„åå¥½å’Œæœ€æ–°çš„ç”¨æˆ·æ¶ˆæ¯ç”Ÿæˆä¸ªæ€§åŒ–çš„å›å¤ã€‚å¦‚æœç”¨æˆ·æœ‰é”®ç›˜å¸ƒå±€åå¥½ï¼Œæˆ‘ä»¬å°±åŸºäºè¿™ä¸ªåå¥½æ¥æ¨èé”®ç›˜æ–¹æ¡ˆï¼Œå¦åˆ™ä½¿ç”¨é»˜è®¤æ–¹æ¡ˆã€‚åŒæ—¶æˆ‘ä»¬ä¹Ÿä¼šåœ¨å›å¤ä¸­æåŠç”¨æˆ·åˆšæ‰è¯´çš„è¯ï¼Œè¿™æ ·ç”¨æˆ·å°±èƒ½æ„Ÿå—åˆ°æœºå™¨äººç¡®å®åœ¨è®¤çœŸå¬ä»–è¯´è¯ã€‚

å³è¾¹çš„æ—¶åºå›¾å±•ç¤ºäº†å®Œæ•´çš„è®°å¿†ç®¡ç†æµç¨‹ï¼š

å½“ç”¨æˆ·å‘é€æ¶ˆæ¯æ—¶ï¼Œåº”ç”¨ä¼šå…ˆä»çŸ­æœŸè®°å¿†ä¸­è·å–å¯¹è¯å†å²ï¼Œäº†è§£ä¹‹å‰èŠäº†ä»€ä¹ˆã€‚ç„¶ååº”ç”¨ä¼šæŸ¥è¯¢é•¿æœŸè®°å¿†ä¸­çš„ç”¨æˆ·åå¥½ï¼Œäº†è§£ç”¨æˆ·çš„å–œå¥½å’Œä¹ æƒ¯ã€‚

æ¥ä¸‹æ¥åº”ç”¨ä¼šåŸºäºå¯¹è¯å†å²å’Œç”¨æˆ·åå¥½æ¥å¤„ç†æ¶ˆæ¯å¹¶ç”Ÿæˆå›å¤ã€‚ç”Ÿæˆå›å¤åï¼Œåº”ç”¨ä¼šå°†æ–°çš„æ¶ˆæ¯ä¿å­˜åˆ°çŸ­æœŸè®°å¿†ä¸­ï¼Œå¹¶åˆ›å»ºæ£€æŸ¥ç‚¹ã€‚

åŒæ—¶ï¼Œåº”ç”¨ä¹Ÿä¼šæ›´æ–°é•¿æœŸè®°å¿†ä¸­çš„ç”¨æˆ·ä¿¡æ¯ï¼Œå°†æ–°çš„å­¦ä¹ ç»“æœä¿å­˜åˆ° Store ä¸­ã€‚æœ€åï¼Œåº”ç”¨ä¼šå‘ç”¨æˆ·è¿”å›ä¸ªæ€§åŒ–çš„å›å¤ã€‚

è¿™ä¸ªæµç¨‹å›¾ä¸­ç‰¹åˆ«é‡è¦çš„æ˜¯ä¸¤ä¸ªæ³¨é‡Šï¼šçŸ­æœŸè®°å¿†è´Ÿè´£çº¿ç¨‹çº§åˆ«çš„çŠ¶æ€ç®¡ç†ï¼Œè€Œé•¿æœŸè®°å¿†è´Ÿè´£è·¨çº¿ç¨‹çš„ä¿¡æ¯å…±äº«ã€‚

é€šè¿‡è¿™æ ·çš„è®°å¿†ç®¡ç†æœºåˆ¶ï¼Œæœºå™¨äººèƒ½å¤Ÿæä¾›çœŸæ­£ä¸ªæ€§åŒ–çš„æ™ºèƒ½æœåŠ¡ï¼Œè®©ç”¨æˆ·æ„Ÿè§‰æ¯æ¬¡å¯¹è¯éƒ½æ˜¯è¿è´¯çš„ï¼Œè€Œä¸”æœºå™¨äººä¼š"è®°ä½"è‡ªå·±çš„å–œå¥½å’Œä¹ æƒ¯ã€‚
-->

<arg_value>

---
layout: two-cols
---

# âš¡ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

## æ™ºèƒ½å†å²è£å‰ª

```typescript
// æ™ºèƒ½å†å²è£å‰ªï¼šæ··åˆè£å‰ª + æ ‡è®°é‡è¦æ¶ˆæ¯
type Message = {
  role: 'user' | 'assistant';
  content: string;
  important?: boolean
};

function smartTrim(
  messages: Message[],
  keep: number = 16
): Message[] {
  const important = messages.filter(m => m.important);
  const recent = messages
    .filter(m => !m.important)
    .slice(-keep);

  // å»é‡å¹¶æŒ‰æ—¶é—´ä¿åº
  const merged = [...important, ...recent];
  const seen = new Set<Message>();
  return merged.filter(m =>
    (seen.has(m) ? false : (seen.add(m), true))
  );
}
```

::right::

## åå°è®°å¿†å†™å…¥

```typescript
// åå°è®°å¿†å†™å…¥ï¼šé™ä½å»¶è¿Ÿ
async function writeMemoryInBackground(
  task: () => Promise<void>
) {
  // ä½¿ç”¨é˜Ÿåˆ—/ä»»åŠ¡ç³»ç»Ÿ
  setTimeout(() => {
    task().catch((e) =>
      console.error('memory write failed', e)
    );
  }, 0);
}

// ä½¿ç”¨ç¤ºä¾‹ï¼š
writeMemoryInBackground(async () => {
  await store.put(
    'app/user/42/runtime',
    'lastSeenAt',
    Date.now()
  );
});
```

<!--
åœ¨æ„å»ºé«˜æ€§èƒ½çš„è®°å¿†ç³»ç»Ÿæ—¶ï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘ä¸€äº›é‡è¦çš„ä¼˜åŒ–ç­–ç•¥ã€‚

å·¦è¾¹çš„ä»£ç å±•ç¤ºäº†ä¸€ä¸ªæ™ºèƒ½å†å²è£å‰ªçš„å®ç°ã€‚è¿™ä¸ªå‡½æ•°æ¯”ä¹‹å‰çœ‹åˆ°çš„ç®€å•è£å‰ªæ›´åŠ æ™ºèƒ½ï¼Œå®ƒé‡‡ç”¨äº†æ··åˆè£å‰ªçš„ç­–ç•¥ï¼ŒåŒæ—¶æ”¯æŒæ ‡è®°é‡è¦æ¶ˆæ¯ã€‚

smartTrim å‡½æ•°é¦–å…ˆä¼šè¿‡æ»¤å‡ºæ‰€æœ‰æ ‡è®°ä¸ºé‡è¦çš„æ¶ˆæ¯ï¼Œç¡®ä¿è¿™äº›å…³é”®ä¿¡æ¯ä¸ä¼šè¢«åˆ é™¤ã€‚ç„¶åå¯¹äºæ™®é€šæ¶ˆæ¯ï¼Œå®ƒä¼šä¿ç•™æœ€æ–°çš„æŒ‡å®šæ•°é‡ã€‚æ¥ç€å°†é‡è¦æ¶ˆæ¯å’Œæœ€æ–°æ¶ˆæ¯åˆå¹¶ï¼Œæœ€åé€šè¿‡å»é‡ç¡®ä¿ä¸ä¼šå‡ºç°é‡å¤çš„æ¶ˆæ¯ã€‚

è¿™ç§ç­–ç•¥çš„ä¼˜åŠ¿åœ¨äºå®ƒæ—¢ä¿è¯äº†å¯¹é‡è¦ä¿¡æ¯çš„ä¿æŠ¤ï¼Œåˆæ§åˆ¶äº†è®°å¿†çš„å¤§å°ï¼ŒåŒæ—¶è¿˜ä¿æŒäº†å¯¹è¯çš„æ—¶é—´é¡ºåºã€‚

å³è¾¹çš„ä»£ç å±•ç¤ºäº†åå°è®°å¿†å†™å…¥çš„å®ç°ã€‚writeMemoryInBackground å‡½æ•°æ¥æ”¶ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡ä½œä¸ºå‚æ•°ï¼Œç„¶åä½¿ç”¨ setTimeout å°†è¿™ä¸ªä»»åŠ¡æ¨è¿Ÿåˆ°ä¸‹ä¸€ä¸ªäº‹ä»¶å¾ªç¯ä¸­æ‰§è¡Œã€‚è¿™æ ·å¯ä»¥é¿å…è®°å¿†å†™å…¥æ“ä½œé˜»å¡ä¸»è¦çš„å“åº”æµç¨‹ï¼Œä»è€Œé™ä½ç”¨æˆ·æ„ŸçŸ¥çš„å»¶è¿Ÿã€‚

åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä¸€äº›ä¸ç´§æ€¥çš„è®°å¿†æ“ä½œæ”¾åˆ°åå°æ‰§è¡Œï¼Œæ¯”å¦‚è®°å½•ç”¨æˆ·çš„æœ€åè®¿é—®æ—¶é—´ã€æ›´æ–°ä½¿ç”¨ç»Ÿè®¡ä¿¡æ¯ç­‰ã€‚è¿™äº›æ“ä½œä¸éœ€è¦ç«‹å³å®Œæˆï¼Œå¯ä»¥ç¨åå¼‚æ­¥å¤„ç†ã€‚

ä»£ç ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨è¿™ä¸ªå‡½æ•°æ¥è®°å½•ç”¨æˆ·æœ€åè®¿é—®æ—¶é—´ã€‚æˆ‘ä»¬å°†è¿™ä¸ªæ“ä½œåŒ…è£…åœ¨ä¸€ä¸ªå¼‚æ­¥å‡½æ•°ä¸­ï¼Œç„¶åä¼ é€’ç»™ writeMemoryInBackgroundï¼Œè¿™æ ·å®ƒå°±ä¼šåœ¨åå°æ‰§è¡Œï¼Œä¸ä¼šå½±å“ç”¨æˆ·çš„ä½“éªŒã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåå°ä»»åŠ¡å¯èƒ½ä¼šå¤±è´¥ï¼Œæ‰€ä»¥æˆ‘ä»¬æ·»åŠ äº†é”™è¯¯å¤„ç†ï¼Œåœ¨æ§åˆ¶å°è®°å½•é”™è¯¯ä¿¡æ¯ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œä½ å¯èƒ½éœ€è¦æ›´å®Œå–„çš„é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶ã€‚

è¿™äº›ä¼˜åŒ–ç­–ç•¥ç¡®ä¿äº†è®°å¿†ç³»ç»Ÿèƒ½å¤Ÿé«˜æ•ˆè¿è¡Œï¼Œæ—¢ä¿è¯äº†æ€§èƒ½ï¼Œåˆä¸ä¼šå½±å“ç”¨æˆ·ä½“éªŒã€‚
-->

---
layout: two-cols
---

# ğŸš¨ æœ€ä½³å®è·µ

## æ ¸å¿ƒåŸåˆ™

::tip:: è®°å¿†ç®¡ç†æœ€ä½³å®è·µ

1. **åˆç†è®¾è®¡å‘½åç©ºé—´**ï¼šä½¿ç”¨å±‚æ¬¡åŒ–å‘½åç©ºé—´
2. **æ§åˆ¶è®°å¿†å¤§å°**ï¼šé¿å…å­˜å‚¨è¿‡å¤§æ•°æ®å¯¹è±¡
3. **å®šæœŸæ¸…ç†**ï¼šå®ç°è®°å¿†çš„è¿‡æœŸå’Œæ¸…ç†æœºåˆ¶
4. **é”™è¯¯å¤„ç†**ï¼šå¦¥å–„å¤„ç†å­˜å‚¨å¤±è´¥çš„æƒ…å†µ
5. **éšç§ä¿æŠ¤**ï¼šæ•æ„Ÿä¿¡æ¯è¦åŠ å¯†å­˜å‚¨

::

::right::

## æ³¨æ„äº‹é¡¹

::warning:: é‡è¦æé†’

- çŸ­æœŸè®°å¿†ä¾èµ–æ£€æŸ¥ç‚¹æœºåˆ¶
- é•¿æœŸè®°å¿†éœ€è¦åˆç†è®¾è®¡å‘½åç©ºé—´
- è®°å¿†æ•°æ®å¯èƒ½åŒ…å«æ•æ„Ÿä¿¡æ¯
- å®šæœŸæ¸…ç†è¿‡æœŸè®°å¿†
- è€ƒè™‘åŠ å¯†å’Œéšç§ä¿æŠ¤

::

## å‘½åç©ºé—´è®¾è®¡

```typescript
// æ¨èçš„å‘½åç©ºé—´ç»“æ„
const namespaces = {
  user: 'app/user/{userId}/prefs',
  session: 'app/session/{sessionId}/data',
  system: 'app/system/config',
  cache: 'app/cache/{category}'
};
```

<!--
æœ€åï¼Œè®©æˆ‘ä»¬æ€»ç»“ä¸€ä¸‹è®°å¿†ç®¡ç†çš„æœ€ä½³å®è·µå’Œæ³¨æ„äº‹é¡¹ã€‚

å·¦è¾¹çš„æç¤ºæ¡†åˆ—å‡ºäº†äº”ä¸ªæ ¸å¿ƒçš„æœ€ä½³å®è·µåŸåˆ™ï¼š

åˆç†è®¾è®¡å‘½åç©ºé—´æ˜¯éå¸¸é‡è¦çš„ã€‚æˆ‘ä»¬åº”è¯¥ä½¿ç”¨å±‚æ¬¡åŒ–çš„å‘½åç©ºé—´æ¥ç»„ç»‡ä¸åŒç±»å‹çš„è®°å¿†æ•°æ®ï¼Œå°±åƒæ–‡ä»¶ç³»ç»Ÿä¸€æ ·ã€‚è¿™æ ·å¯ä»¥é¿å…æ•°æ®å†²çªï¼Œè®©è®°å¿†ç»“æ„æ›´æ¸…æ™°ã€‚

æ§åˆ¶è®°å¿†å¤§å°ä¹Ÿå¾ˆå…³é”®ã€‚æˆ‘ä»¬åº”è¯¥é¿å…å­˜å‚¨è¿‡å¤§çš„æ•°æ®å¯¹è±¡ï¼Œè¿™ä¼šå½±å“æ€§èƒ½å’Œå­˜å‚¨æˆæœ¬ã€‚å¯¹äºå¤§æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘å­˜å‚¨æ–‡ä»¶è·¯å¾„è€Œä¸æ˜¯æ–‡ä»¶æœ¬èº«ã€‚

å®šæœŸæ¸…ç†æ˜¯ä¿æŒç³»ç»Ÿå¥åº·çš„é‡è¦æªæ–½ã€‚æˆ‘ä»¬éœ€è¦å®ç°è®°å¿†çš„è¿‡æœŸå’Œæ¸…ç†æœºåˆ¶ï¼Œåˆ é™¤ä¸å†éœ€è¦çš„æ•°æ®ï¼Œé˜²æ­¢å­˜å‚¨ç©ºé—´æ— é™å¢é•¿ã€‚

é”™è¯¯å¤„ç†ä¸èƒ½å¿½è§†ã€‚å­˜å‚¨æ“ä½œå¯èƒ½ä¼šå¤±è´¥ï¼Œæˆ‘ä»¬éœ€è¦å¦¥å–„å¤„ç†è¿™äº›æƒ…å†µï¼Œæ¯”å¦‚é‡è¯•æœºåˆ¶ã€é”™è¯¯æ—¥å¿—è®°å½•ç­‰ã€‚

éšç§ä¿æŠ¤æ˜¯å¿…é¡»è€ƒè™‘çš„ã€‚æ•æ„Ÿä¿¡æ¯ä¸€å®šè¦åŠ å¯†å­˜å‚¨ï¼Œå¹¶ä¸”è¦éµå®ˆç›¸å…³çš„æ•°æ®ä¿æŠ¤æ³•è§„ã€‚

å³è¾¹çš„è­¦å‘Šæ¡†å¼ºè°ƒäº†å‡ ä¸ªé‡è¦çš„æ³¨æ„äº‹é¡¹ï¼š

çŸ­æœŸè®°å¿†ä¾èµ–æ£€æŸ¥ç‚¹æœºåˆ¶ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬éœ€è¦æ­£ç¡®é…ç½®æ£€æŸ¥ç‚¹å­˜å‚¨ï¼Œç¡®ä¿æ•°æ®çš„æŒä¹…åŒ–ã€‚

é•¿æœŸè®°å¿†éœ€è¦åˆç†è®¾è®¡å‘½åç©ºé—´ï¼Œé¿å…ä¸åŒç±»å‹çš„æ•°æ®ç›¸äº’å¹²æ‰°ã€‚

è®°å¿†æ•°æ®å¯èƒ½åŒ…å«æ•æ„Ÿä¿¡æ¯ï¼Œæˆ‘ä»¬è¦ç‰¹åˆ«æ³¨æ„æ•°æ®å®‰å…¨å’Œéšç§ä¿æŠ¤ã€‚

å®šæœŸæ¸…ç†è¿‡æœŸè®°å¿†æ˜¯å¿…è¦çš„ï¼Œé˜²æ­¢ç³»ç»Ÿæ€§èƒ½ä¸‹é™ã€‚

è€ƒè™‘åŠ å¯†å’Œéšç§ä¿æŠ¤æªæ–½ï¼Œç¡®ä¿ç”¨æˆ·æ•°æ®çš„å®‰å…¨ã€‚

å³ä¸‹è§’çš„ä»£ç å±•ç¤ºäº†æ¨èçš„å‘½åç©ºé—´ç»“æ„ã€‚æˆ‘ä»¬æŒ‰ç…§åŠŸèƒ½å’Œæ•°æ®ç±»å‹æ¥ç»„ç»‡å‘½åç©ºé—´ï¼š

user å‘½åç©ºé—´ç”¨äºå­˜å‚¨ç”¨æˆ·ç›¸å…³çš„åå¥½è®¾ç½®
session å‘½åç©ºé—´ç”¨äºå­˜å‚¨ä¼šè¯çº§åˆ«çš„ä¸´æ—¶æ•°æ®
system å‘½åç©ºé—´ç”¨äºå­˜å‚¨ç³»ç»Ÿé…ç½®ä¿¡æ¯
cache å‘½åç©ºé—´ç”¨äºå­˜å‚¨ç¼“å­˜æ•°æ®

è¿™ç§å±‚æ¬¡åŒ–çš„å‘½åç©ºé—´è®¾è®¡è®©è®°å¿†ç®¡ç†æ›´åŠ æœ‰åºå’Œå¯ç»´æŠ¤ã€‚

éµå¾ªè¿™äº›æœ€ä½³å®è·µï¼Œæˆ‘ä»¬å°±èƒ½æ„å»ºå‡ºå®‰å…¨å¯é çš„è®°å¿†ç³»ç»Ÿï¼Œä¸ºç”¨æˆ·æä¾›ç¨³å®šä¼˜è´¨çš„æ™ºèƒ½æœåŠ¡ã€‚
-->

---
layout: center
class: text-center
---

# ğŸ‰ æ€»ç»“

## è®°å¿†ç®¡ç†æ˜¯æ„å»ºæ™ºèƒ½åº”ç”¨çš„åŸºç¡€èƒ½åŠ›

é€šè¿‡åˆç†ä½¿ç”¨**çŸ­æœŸè®°å¿†**å’Œ**é•¿æœŸè®°å¿†**ï¼Œä½ å¯ä»¥åˆ›å»ºå‡ºçœŸæ­£æ™ºèƒ½ã€ä¸ªæ€§åŒ–çš„ç”¨æˆ·ä½“éªŒã€‚

<br>

<div class="grid grid-cols-2 gap-4">
<div>

### ğŸ§  æ ¸å¿ƒèƒ½åŠ›
- ä¸Šä¸‹æ–‡æ„ŸçŸ¥
- ä¸ªæ€§åŒ–ä½“éªŒ
- çŸ¥è¯†ç§¯ç´¯
- æ™ºèƒ½äº¤äº’

</div>
<div>

### ğŸš€ åº”ç”¨åœºæ™¯
- æ™ºèƒ½å®¢æœ
- ä¸ªæ€§åŒ–åŠ©æ‰‹
- çŸ¥è¯†ç®¡ç†
- å­¦ä¹ ç³»ç»Ÿ

</div>
</div>

<br>

**ä¸ºæ„å»ºæ›´å¤æ‚çš„ AI åº”ç”¨å¥ å®šäº†åšå®çš„åŸºç¡€ã€‚**

<!--
æœ€åï¼Œè®©æˆ‘ä»¬å¯¹ä»Šå¤©çš„åˆ†äº«åšä¸€ä¸ªæ€»ç»“ã€‚

è®°å¿†ç®¡ç†ç¡®å®æ˜¯æ„å»ºæ™ºèƒ½åº”ç”¨çš„åŸºç¡€èƒ½åŠ›ã€‚é€šè¿‡åˆç†ä½¿ç”¨çŸ­æœŸè®°å¿†å’Œé•¿æœŸè®°å¿†ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºå‡ºçœŸæ­£æ™ºèƒ½ã€ä¸ªæ€§åŒ–çš„ç”¨æˆ·ä½“éªŒã€‚

å·¦è¾¹çš„æ ¸å¿ƒèƒ½åŠ›å±•ç¤ºäº†è®°å¿†ç®¡ç†å¸¦æ¥çš„å››ä¸ªå…³é”®ä»·å€¼ï¼š

ä¸Šä¸‹æ–‡æ„ŸçŸ¥è®© AI èƒ½å¤Ÿç†è§£å½“å‰çš„å¯¹è¯æƒ…å¢ƒï¼ŒåŸºäºå†å²ä¿¡æ¯åšå‡ºæ›´åˆé€‚çš„å›åº”ã€‚

ä¸ªæ€§åŒ–ä½“éªŒè®©æ¯ä¸ªç”¨æˆ·éƒ½èƒ½æ„Ÿå—åˆ° AI ä¸ºè‡ªå·±é‡èº«å®šåˆ¶çš„æœåŠ¡ï¼Œè€Œä¸æ˜¯åƒç¯‡ä¸€å¾‹çš„æ ‡å‡†å›å¤ã€‚

çŸ¥è¯†ç§¯ç´¯è®© AI èƒ½å¤Ÿä»æ¯æ¬¡äº¤äº’ä¸­å­¦ä¹ ï¼Œä¸æ–­æ”¹è¿›å’Œä¼˜åŒ–è‡ªå·±çš„è¡¨ç°ã€‚

æ™ºèƒ½äº¤äº’åˆ™ä½“ç°åœ¨ AI èƒ½å¤Ÿä¸»åŠ¨è®°ä½ç”¨æˆ·çš„åå¥½ï¼Œé¢„æµ‹ç”¨æˆ·çš„éœ€æ±‚ï¼Œæä¾›æ›´è´´å¿ƒçš„æœåŠ¡ã€‚

å³è¾¹çš„åº”ç”¨åœºæ™¯å±•ç¤ºäº†è®°å¿†ç®¡ç†çš„å®é™…ç”¨é€”ï¼š

åœ¨æ™ºèƒ½å®¢æœé¢†åŸŸï¼Œè®°å¿†ç®¡ç†è®©å®¢æœæœºå™¨äººèƒ½å¤Ÿè®°ä½å®¢æˆ·çš„å†å²é—®é¢˜å’Œåå¥½ï¼Œæä¾›æ›´ç²¾å‡†çš„æœåŠ¡ã€‚

ä½œä¸ºä¸ªæ€§åŒ–åŠ©æ‰‹ï¼ŒAI å¯ä»¥è®°ä½ç”¨æˆ·çš„ä¹ æƒ¯å’Œå–œå¥½ï¼Œæˆä¸ºçœŸæ­£æ‡‚ç”¨æˆ·çš„æ•°å­—ä¼™ä¼´ã€‚

åœ¨çŸ¥è¯†ç®¡ç†æ–¹é¢ï¼Œè®°å¿†ç³»ç»Ÿå¯ä»¥å¸®åŠ©ç»„ç»‡å’Œç®¡ç†å¤§é‡ä¿¡æ¯ï¼Œè®©çŸ¥è¯†æ›´å®¹æ˜“è¢«æ£€ç´¢å’Œåˆ©ç”¨ã€‚

å¯¹äºå­¦ä¹ ç³»ç»Ÿï¼Œè®°å¿†ç®¡ç†è®© AI èƒ½å¤Ÿè·Ÿè¸ªå­¦ä¹ è¿›åº¦ï¼Œè°ƒæ•´æ•™å­¦ç­–ç•¥ï¼Œæä¾›ä¸ªæ€§åŒ–çš„å­¦ä¹ ä½“éªŒã€‚

é€šè¿‡ä»Šå¤©çš„åˆ†äº«ï¼Œæˆ‘ä»¬äº†è§£äº† LangGraphJS ä¸­è®°å¿†ç®¡ç†çš„æ ¸å¿ƒæ¦‚å¿µã€å®ç°æ–¹å¼ã€ä¼˜åŒ–ç­–ç•¥å’Œæœ€ä½³å®è·µã€‚è¿™äº›çŸ¥è¯†ä¸ºå¤§å®¶æ„å»ºæ›´å¤æ‚çš„ AI åº”ç”¨å¥ å®šäº†åšå®çš„åŸºç¡€ã€‚

è®°å¿†ç®¡ç†è®© AI åº”ç”¨çœŸæ­£å˜å¾—"æ™ºèƒ½"ã€‚å®ƒä¸ä»…ä»…æ˜¯æŠ€æœ¯å®ç°ï¼Œæ›´æ˜¯è¿æ¥ AI ä¸ç”¨æˆ·çš„æ¡¥æ¢ï¼Œè®©å†°å†·çš„ç®—æ³•å˜å¾—æœ‰æ¸©åº¦ï¼Œè®©æ ‡å‡†åŒ–çš„æœåŠ¡å˜å¾—ä¸ªæ€§åŒ–ã€‚

å¸Œæœ›ä»Šå¤©çš„åˆ†äº«èƒ½å¤Ÿå¸®åŠ©å¤§å®¶åœ¨ä»Šåçš„é¡¹ç›®ä¸­ï¼Œæ„å»ºå‡ºæ›´åŠ æ™ºèƒ½ã€æ›´åŠ è´´å¿ƒçš„ AI åº”ç”¨ã€‚
è°¢è°¢å¤§å®¶ï¼
-->